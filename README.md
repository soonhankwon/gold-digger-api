<div align="center">
  <img src="https://github.com/soonhankwon/gold-digger-api/assets/113872320/e053fc62-976c-4890-9db8-de6c526cb902" alt="logo" align="center" width="60%" />  
</div>

# 예산 관리 애플리케이션 백엔드 API
- 본 서비스는 사용자들이 개인 재무를 관리하고 지출을 추적하는 데 도움을 주는 애플리케이션 입니다.
- 이 앱은 사용자들이 예산을 설정하고 지출을 모니터링하며 재무 목표를 달성하는 데 도움이 됩니다.
<br/>

## Table Of Contents
- [유저스토리](#유저스토리)
- [기술스택](#기술스택)
- [아키텍처](#아키텍처)
- [API 명세서](#api-명세서)
- [ERD](#erd)
- [프로젝트 진행 및 이슈관리](#프로젝트-진행-및-이슈관리)
- [구현과정(설계 및 의도)](#구현과정(설계-및-의도))
- [핵심문제 해결과정 및 전략](#핵심문제-해결과정-및-전략)
<br/>

## 유저스토리
- 유저는 본 사이트에 들어와 회원가입을 통해 서비스를 이용합니다. 
- 예산 설정 및 설계 서비스
  - `월별` 총 예산을 설정합니다.
  - 본 서비스는 `카테고리 별` 예산을 `설계(=추천)`하여 사용자의 과다 지출을 방지합니다.
- 지출 기록
  - 사용자는 `지출`을  금액, 카테고리, 메모, 지출일시를 지정하여 `등록` 합니다. 언제든지 `수정` 및 `삭제` 할 수 있습니다.
- 지출 컨설팅
  - `월별` 설정한 예산을 기준으로 오늘 소비 가능한 `지출` 을 알려줍니다.
  - 매일 발생한 `지출` 을 `카테고리` 별로 안내받습니다.
- 지출 통계
  - `지난 달 대비` , `지난 요일 대비`,  `다른 유저 대비` 등 여러 기준 `카테고리 별` 지출 통계를 확인 할 수 있습니다.
<br/>

## 기술스택
### 언어 및 라이브러리
- Java 17 Amazon Corretto
- SpringBoot 3.1.5
- Spring Data JPA 3.1.5
- Querydsl 5.0.0
- Spring Data Redis 3.1.5
- Spring WebFlux 6.0.13
- Spring Security 6.1.5
- JJWT 0.12.3
- Swagger v3 2.2.9
### 데이터베이스
- MySQL 8.0.33
- Redis 7.0.8
<br/>

## api 명세서
- Swagger : http://localhost:8080/swagger-ui/index.html
- `로그인 API`는 시큐리티에서 제공하도록 구현해서 스웨거로 문서화되지 않았습니다.
  ```plain
  - url: /sign-in
  - method: POST
  - body: { username: "tester123", password: "password1!" }
  ```  
<br/>

## erd
<br/>

## 프로젝트 진행 및 이슈관리
- 프로젝트 진행시 `전체적인 진행 현황` 과 `시간을 효율적으로 관리`하기 위해서 `깃허브 프로젝트`를 활용했습니다.
- 프로젝트에 필요한 구현해야할 기능 등 을 `이슈`발행하여 `시작 & 데드라인` 기간을 설정, `로드맵`에서 한눈에 파악할 수 있도록 했습니다.
  - 이슈형식이 달라 알아보기 힘든 경우를 방지하도록 `이슈템플릿`을 등록하여 통일된 형식으로 이슈를 관리했습니다.
- `칸반보드`도 연동되기 때문에 TODO, IN PROGRESS, DONE으로 프로젝트의 `티켓`들을 관리했습니다.  
- 개인 프로젝트이기 때문에 브랜치 관리전략은 Master(Production) - Dev로 간단하게 가져갔습니다.
- Dev 브랜치를 소스로 `이슈브랜치`에서 작업 & PR & MERGE 과정으로 진행했습니다.
- 하루에 한번 기준으로 Dev to Master(Production)로 PR & MERGE를 진행했습니다.
<br/>

## 구현과정(설계 및 의도)
### 사용자 회원가입 & 로그인 고려사항
---
1. 회원가입 API
- 서비스에 필요한 회원 정보를 잘 `모델링`했나?
  - 본 서비스는 유저 고유 정보가 크게 사용되지 않아 간단히 구현되어 있습니다.
  - 계정명(username): 구글 가이드라인에 따라 `6자이상 ~ 30자이하`로 설정하였습니다.
  - 패스워드(password): 패스워드는 최소 `8글자이상` `숫자, 문자, 특수문자를 포함`하도록 설정하였습니다.
  - 디스코드웹훅url(discordUrl): 알람서비스를 위한 `개인 디스코드 웹훅 url`입니다.
    - 유저가 입력하지 않는 경우 기본값으로 `NONE`으로 DB에 저장되며 이후 알람서비스에서 NONE이 아니면서 알람설정을한 유저에게만 알람서비스를 제공합니다.
    - DB에 null로 넣지 않은 이유는 기본적으로 MySQL의 null은 `unknown` 이며 비교/논리연산시 결과로 true, false, unknown을 가지기때문에 예상하지 못한 연산결과를 피하고 싶었습니다. 
  - 알람수신여부(subscribeNotification): 알람서비스 수신 여부
    - 서비스에 디스코드 웹훅을 통한 `알람서비스`가 포함되어있습니다.
    - 해당 수신여부를 꼭 설정해야 불필요한 DB스캔 및 사용자 경험을 개선시킬수 있다고 생각했습니다.
- 패스워드는 잘 `암호화` 되어있나?
  - 시큐리티에서 제공하는 `PasswordEncoderFactories`의 createDelegatingPasswordEncoder 메서드를 통해 인코더를 빈으로 등록했습니다.
    - 이유는 인증, 인가에 대해서는 최대한 시큐리티에서 제공하는 흐름대로 구현하는것이 `안정성`면에서 좋다고 생각했습니다.
  - 시큐리티에 위임하는 인코더를 통해 `패스워드를 암호화`하고 로그인시에도 시큐리티가 인증절차에서 해당 인코더로 패스워드 검증을 수행합니다. 
2. 로그인 API
- 로그인시 `JWT`가 잘 발급이 되나?
  - 인증과정에서 가장 중점을 뒀던 점은 시큐리티에서 제공하는 흐름과 기능을 최대한 맞춰서 이용하는 것이었습니다.
  - 이유는 시큐리티는 `보안에 전문적`인 라이브러리이기 때문에 저보다 보안에 훨씬 전문적이라고 생각하기 때문입니다.
  - 시큐리티의 `AuthenticationManager`와 `JwtAuthenticationFilter`를 통해 로그인을 수행하도록 했습니다.
  - JwtAuthenticationFilter 인증과정을 통해 로그인이 정상적이라면 `헤더`에 `AccessToken`과 `RefreshToken`을 발급합니다.
- 이후 헤더의 AccessToken를 통해 url `인가`가 이루어지며, AccessToken 만료시 RefreshToken을 통해 재발급을 받습니다.
  
### 예산설정 및 설계 API
---
1. 지출 카테고리
- 지출 카테고리는 `식비`, `쇼핑`, `교통`, `오락`, `자기계발`, `의료`, `경조사`, `투자`, `여행`, `기타`로 구성하였습니다.
- Daily Pay, Daak 가계부(App Store)를 리서칭한 결과 `공통적으로 겹치는 카테고리`였고, 생산성을 위해 초기에는 큰 카테고리로 구현 & 니즈에 따라 세부 카테고리를 추가하는 방향으로 설정했습니다.
2. 지출 카테고리 목록 조회 API
- 카테고리 목록은 `서비스측에서 설정한 지출 카테고리`를 제공합니다. 따라서 DB에는 사측의 결정에 의해서만 카테고리가 업데이트됩니다.
- 따라서 지출 카테고리 목록 조회 API는 초기에 조회결과를 Redis에 `캐싱`을 해두고 이후에는 캐싱된 결과를 조회하도록 하여 불필요한 DB I/O를 방지하도록 했습니다.   
3. 유저 예산설정 API  
- 유저예산 설정(POST): 월단위로 `예산` 을 설정합니다. 예산은 `카테고리` 를 필수로 지정합니다.
  - `유저예산 테이블`은 `유저`와 `지출카테고리`를 `FK`로 가지고 필요한 경우 JOIN해서 로직을 수행할수있도록 `연관관계`를 설정했습니다. 
  - 예산은 액수, 년, 월을 요청받아 만들어집니다.
- 유저예산 수정(PATCH): 사용자는 예산의 액수, 년, 월, 지출 카테고리를 `변경`할 수 있도록 구현했습니다.
- 년, 월, 지출 카테고리를 변경했을 경우 `기존 예산과 중복`된다면?
  - 유저예산 테이블에 설정년월을 의미하는 `plannedMonth`라는 datetime 데이터 타입의 컬럼을 만들었습니다.
  - plannedMonth는 ex)`2023-11-01 00:00:00.000000`로 DB에 저장됩니다.
  - 예산을 변경하고 유저에게 이미 plannedMonth와 카테고리가 같은 설정예산이 있다면 `예외처리`합니다.  
4. 예산설계(=추천) API
- 카테고리 별 예산 설정에 어려움이 있는 사용자를 위해 `예산 비율 추천 기능` API입니다.
- 카테고리 지정 없이 총액 (ex. 100만원) 을 입력하면, 카테고리 별 예산을 자동 생성합니다.
#### 예산추천 조회(GET): 기존 이용중인 유저 들이 설정한 `카테고리 예산 설정 비율의 평균 값`입니다.
- 카테고리 별 예산 비율 평균값이 기준에 따라서 `왜곡`되지는 않는가?
  - 금액을 총합해서 카테고리 별 예산비율을 내면 사용자들끼리의 카테고리별 예산이 크게 차이가 난다면 평균값이 왜곡됩니다.
  - 따라서, 각 유저의 총 예산 대비 `카테고리 예산 설정비율의 평균값`으로 해당 기능을 구현했습니다.
  - ex) A유저의 식사 카테고리 설정비율 20%, B유저의 식사 카테고리 설정비율 10% -> 추천 식사 카테고리 설정비율 15%   
#### 추천예산 설정(POST): 유저는 예산 추천 기능으로 입력 된 값들을 필요에 따라 수정(화면에서) 한 뒤 이를 저장(=추천 예산설정 API)합니다.
- `중복된 해당 월 & 카테고리의 유저 예산`이 존재할 경우?
  - `추천된 List`로 요청을 받는 추천 예산설정API의 비즈니스 로직 루프에서 유저예산 객체생성후 `기존 중복된 예산이 있는지 검증`하여 `예외처리`하도록 했습니다.  

### 지출기록
---
1. 지출
- 서비스에 필요한 지출 정보를 잘 `모델링`했나?
  - `지출 일시`, `지출 금액`, `카테고리` 와 `메모` 를 입력하여 생성합니다.
  - 서비스에 `지출을 합계에서 제외`하는 API가 있어 ExpenditureStatus(INCLUDED, EXCLUDED) `ENUM`으로 `상태`를 정의하였습니다.
  - `지출 테이블`은 `유저`와 `지출카테고리`를 `FK`로 가지고 필요한 경우 `JOIN`해서 로직을 수행할수있도록 `연관관계`를 설정했습니다.

2. 지출 CRUD
   
### 지출 컨설팅
---
1. 오늘 지출 추천 API
2. 오늘 지출 안내 API

### 지출 통계
---
1. 지출 통계 API
<br/>

## 핵심문제 해결과정 및 전략
<br/>
